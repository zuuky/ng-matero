<ng-template cdkConnectedOverlay
             [cdkConnectedOverlayOrigin]="overlayOrigin"
             [cdkConnectedOverlayOpen]="model.overlayOpen"
             [cdkConnectedOverlayFlexibleDimensions]="true"
             cdkConnectedOverlayOffsetY=8
             cdkConnectedOverlayBackdropClass='tree-backdrop'
             [cdkConnectedOverlayHasBackdrop]="true"
             (backdropClick)="backdropClick()">
  <mat-card class="mat-elevation-z8" [ngStyle]="{'width':overlayOrigin.elementRef.nativeElement.clientWidth+'px'}">
    <mat-card-header>
      <mat-card-title>
        <mat-form-field>
          <label>
            <input matInput type="text" [(ngModel)]="filterValue" (ngModelChange)="filterItem($event)"
                   placeholder="filter">
          </label>
        </mat-form-field>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content [ngStyle]="{'min-height':'100px','max-height':'300px','overflow':'auto'}">
      <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
        <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding>
          <button mat-icon-button disabled></button>
          <ng-container *ngIf="model.multiple">
            <mat-checkbox class="checklist-leaf-node"
                          [checked]="checklistSelection.isSelected(node)"
                          (change)="todoLeafItemSelectionToggle(node)">{{node.item}}</mat-checkbox>
          </ng-container>
          <ng-container *ngIf="!model.multiple">
            <mat-option (click)="unmultipleChecked(node)">{{node.item}}</mat-option>
          </ng-container>
        </mat-tree-node>
        <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
          <button mat-icon-button matTreeNodeToggle
                  [attr.aria-label]="'toggle ' + node.filename">
            <mat-icon class="mat-icon-rtl-mirror">
              {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
            </mat-icon>
          </button>
          <ng-container *ngIf="model.multiple">
            <mat-checkbox [checked]="descendantsAllSelected(node)"
                          [indeterminate]="descendantsPartiallySelected(node)"
                          (change)="todoItemSelectionToggle(node)">{{node.item}}</mat-checkbox>
          </ng-container>
          <ng-container *ngIf="!model.multiple">
            <mat-option *ngIf="!node.expandable" (click)="unmultipleChecked(node)">{{node.item}}</mat-option>
            <mat-option *ngIf="node.expandable" [disabled]="node.expandable">{{node.item}}</mat-option>
          </ng-container>
        </mat-tree-node>
      </mat-tree>
    </mat-card-content>
  </mat-card>

</ng-template>
